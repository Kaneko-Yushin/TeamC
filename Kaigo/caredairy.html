<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ä»‹è­·è¨˜éŒ²ãƒ‡ãƒ¢ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#0ea5a4;
    --danger:#ef4444;
    --radius:14px;
    font-family: system-ui,-apple-system,"Segoe UI","Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic","Roboto","Helvetica Neue",Arial;
  }
  html,body{height:100%;}
  body{
    margin:0;
    background:linear-gradient(180deg,#eef2f7 0%,var(--bg) 100%);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
  }

  .app{
    width:100%;
    max-width:420px;
    box-shadow:0 10px 30px rgba(13,42,64,0.12);
    border-radius:18px;
    overflow:hidden;
    background:var(--card);
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 16px;
    background:linear-gradient(90deg,#ffffff,#f8fafc);
    border-bottom:1px solid #eef2f6;
  }
  .brand{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .logo{
    width:40px;height:40px;border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,#10b981,#06b6d4);
    color:white;font-weight:700;font-size:18px;
    box-shadow:0 4px 10px rgba(6,95,87,0.12);
  }
  h1{font-size:16px;margin:0;color:#0f172a;}
  .controls{display:flex;gap:8px;align-items:center;}

  .lang-btn{
    padding:8px 10px;border-radius:10px;border:none;background:transparent;
    font-size:13px;color:var(--muted);cursor:pointer;
  }
  .lang-btn.active{background:#ecfeff;color:var(--accent);border:1px solid #bff0ef;}

  main{padding:14px;}
  .screen{display:none;}
  .screen.active{display:block;}

  /* User list */
  .users{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .user{
    background:linear-gradient(180deg,#ffffff,#fbfdff);
    padding:12px;border-radius:12px;display:flex;gap:10px;align-items:center;cursor:pointer;
    border:1px solid #f1f5f9;
  }
  .avatar{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#f97316,#f59e0b);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  .uinfo{flex:1;}
  .name{font-weight:700;color:#06202a}
  .sub{font-size:13px;color:var(--muted)}

  /* Card */
  .card{background:var(--card);padding:12px;border-radius:12px;border:1px solid #eef2f6;margin-bottom:10px;}

  /* Big options */
  .options{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px;}
  .opt{
    background:#fbfdff;border-radius:12px;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;
    border:1px solid #eef2f6;font-weight:700;font-size:13px;cursor:pointer;min-height:68px;
  }
  .opt.subtle{font-weight:600;font-size:12px;color:var(--muted)}
  .opt.toggled{box-shadow:0 6px 18px rgba(2,132,199,0.12);transform:translateY(-4px);border-color:rgba(2,132,199,0.18)}
  .opt .emoji{font-size:22px;margin-bottom:6px}

  /* Body state */
  .body-states{display:flex;gap:8px;margin-top:8px;}
  .pill{flex:1;padding:10px;border-radius:12px;text-align:center;font-weight:700;cursor:pointer;border:1px solid #eef2f6}
  .pill.toggled{background:#ecfeff;color:var(--accent);border-color:#bff0ef;box-shadow:0 6px 18px rgba(6,95,87,0.06);transform:translateY(-3px)}

  textarea{
    width:100%;min-height:80px;border-radius:10px;padding:10px;border:1px solid #eef2f6;font-size:14px;resize:vertical;
  }

  .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .save-btn{
    width:100%;padding:12px;border-radius:12px;border:none;background:var(--accent);color:white;font-weight:800;font-size:16px;margin-top:8px;cursor:pointer;
    box-shadow:0 6px 18px rgba(6,95,87,0.12);
  }

  .muted{color:var(--muted);font-size:13px}
  .tiny{font-size:12px;color:#94a3b8}

  /* confirmation */
  .confirm{padding:12px;border-radius:12px;background:linear-gradient(90deg,#ecfeff,#e6fffb);border:1px solid #bff0ef;color:#064e49;font-weight:700}

  footer{padding:10px 14px;background:#ffffff;border-top:1px solid #eef2f6;font-size:13px;color:var(--muted);text-align:center}

  @media (min-width:720px){
    body{background:linear-gradient(180deg,#eef2f7 0%,#ffffff 100%);}
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="ä»‹è­·è¨˜éŒ²ãƒ‡ãƒ¢">
    <header>
      <div class="brand">
        <div class="logo">ä»‹</div>
        <div>
          <h1 id="title">ãƒ‡ã‚¤ã‚±ã‚¢è¨˜éŒ²</h1>
          <div class="tiny" id="subtitle">ã‚¿ãƒƒãƒ—ã§ç°¡å˜è¨˜éŒ²</div>
        </div>
      </div>
      <div class="controls">
        <button id="langToggle" class="lang-btn" aria-label="è¨€èªåˆ‡æ›¿">æ—¥æœ¬èª</button>
      </div>
    </header>

    <main>
      <!-- Screen: user list -->
      <section id="screen-list" class="screen active" aria-live="polite">
        <div class="card">
          <div class="row">
            <div>
              <div class="muted" id="listLabel">åˆ©ç”¨è€…ã‚’é¸æŠ</div>
              <div style="font-weight:700">ä»Šæ—¥ã®æ‹…å½“</div>
            </div>
            <div class="tiny">ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</div>
          </div>
        </div>

        <div class="users" id="userGrid" aria-label="åˆ©ç”¨è€…ä¸€è¦§">
          <!-- users populated by JS -->
        </div>
      </section>

      <!-- Screen: record input -->
      <section id="screen-record" class="screen" aria-live="polite">
        <div class="row" style="margin-bottom:8px;">
          <div>
            <div class="muted" id="recordFor">è¨˜éŒ²å¯¾è±¡</div>
            <div style="font-weight:800" id="recordName">ç”°ä¸­ å¤ªéƒ</div>
            <div class="tiny" id="recordRoom">éƒ¨å±‹: 101</div>
          </div>
          <button id="backBtn" class="lang-btn" aria-label="æˆ»ã‚‹">æˆ»ã‚‹</button>
        </div>

        <div class="card">
          <div class="muted" id="mealLabel">é£Ÿäº‹</div>
          <div class="options" id="mealOpts">
            <div class="opt" data-key="meal" data-value="full"><div class="emoji">ğŸš</div>å®Œé£Ÿ</div>
            <div class="opt" data-key="meal" data-value="half"><div class="emoji">ğŸ¥¢</div>åŠåˆ†</div>
            <div class="opt" data-key="meal" data-value="little"><div class="emoji">ğŸ½ï¸</div>å°‘ã—</div>
            <div class="opt" data-key="meal" data-value="refuse"><div class="emoji">ğŸš«</div>æ‹’å¦</div>
          </div>
        </div>

        <div class="card">
          <div class="muted" id="medLabel">æœè–¬</div>
          <div class="options" id="medOpts">
            <div class="opt" data-key="med" data-value="ok"><div class="emoji">ğŸ’Š</div>é£²ã‚“ã </div>
            <div class="opt" data-key="med" data-value="refuse"><div class="emoji">âœ–ï¸</div>æ‹’å¦</div>
            <div class="opt" data-key="med" data-value="miss"><div class="emoji">âš ï¸</div>å¿˜ã‚Œ</div>
            <div class="opt subtle" data-key="med" data-value="n/a"><div class="emoji">â€”</div>ä¸è¦</div>
          </div>
        </div>

        <div class="card">
          <div class="muted" id="toiletLabel">æ’æ³„</div>
          <div class="options" id="toiletOpts">
            <div class="opt" data-key="toilet" data-value="urine"><div class="emoji">ğŸš½</div>å°¿</div>
            <div class="opt" data-key="toilet" data-value="stool"><div class="emoji">ğŸ’©</div>ä¾¿</div>
            <div class="opt" data-key="toilet" data-value="both"><div class="emoji">âšª</div>ä¸¡æ–¹</div>
            <div class="opt subtle" data-key="toilet" data-value="none"><div class="emoji">â€”</div>ãªã—</div>
          </div>
        </div>

        <div class="card">
          <div class="muted" id="statusLabel">ä½“èª¿</div>
          <div class="body-states" id="moodOpts">
            <div class="pill" data-key="mood" data-value="good">ğŸ˜Š è‰¯ã„</div>
            <div class="pill" data-key="mood" data-value="ok">ğŸ˜ æ™®é€š</div>
            <div class="pill" data-key="mood" data-value="bad">ğŸ˜ æ‚ªã„</div>
          </div>
          <div style="margin-top:10px;" id="noteLabel">ãƒ¡ãƒ¢ (ä»»æ„)</div>
          <textarea id="note" placeholder="çŸ­ã„ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã€‚éŸ³å£°å…¥åŠ›ã¯å°†æ¥å¯¾å¿œäºˆå®š"></textarea>
        </div>

        <button id="saveBtn" class="save-btn">è¨˜éŒ²ã‚’ä¿å­˜</button>
      </section>

      <!-- Screen: confirmation / review -->
      <section id="screen-confirm" class="screen" aria-live="polite">
        <div class="card">
          <div class="confirm" id="confirmMsg">ä¿å­˜ã—ã¾ã—ãŸï¼</div>
          <div style="margin-top:10px;">
            <div class="muted">ä»Šæ—¥ã®è¨˜éŒ²ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</div>
            <div style="margin-top:8px;font-weight:800" id="previewName">ç”°ä¸­ å¤ªéƒ</div>
            <div class="tiny" id="previewTime">â€”</div>

            <div style="margin-top:10px;">
              <div class="muted">é£Ÿäº‹</div>
              <div id="pvMeal" style="font-weight:700;margin-bottom:8px">â€”</div>

              <div class="muted">æœè–¬</div>
              <div id="pvMed" style="font-weight:700;margin-bottom:8px">â€”</div>

              <div class="muted">æ’æ³„</div>
              <div id="pvToilet" style="font-weight:700;margin-bottom:8px">â€”</div>

              <div class="muted">ä½“èª¿</div>
              <div id="pvMood" style="font-weight:700;margin-bottom:8px">â€”</div>

              <div class="muted">ãƒ¡ãƒ¢</div>
              <div id="pvNote" style="font-weight:700">â€”</div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:8px;">
          <button id="newRecord" class="save-btn" style="flex:1;background:#0ea5a4">åˆ¥ã®è¨˜éŒ²ã‚’ä½œæˆ</button>
          <button id="toList" class="save-btn" style="flex:1;background:#e2e8f0;color:#0f172a">åˆ©ç”¨è€…ã¸æˆ»ã‚‹</button>
        </div>
      </section>

    </main>

    <footer>
      ãƒ‡ãƒ¢ç‰ˆ â€” ä½¿ã„ã‚„ã™ã•é‡è¦–ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—
    </footer>
  </div>

<script>
/* =============================
   ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿ã¨ç¿»è¨³
   ============================= */
const USERS = [
  { id: 'u1', name_jp: 'ç”°ä¸­ å¤ªéƒ', name_en: 'Taro Tanaka', room: '101' },
  { id: 'u2', name_jp: 'éˆ´æœ¨ èŠ±å­', name_en: 'Hanako Suzuki', room: '102' },
  { id: 'u3', name_jp: 'Nguyen Van A', name_en: 'Nguyen Van A', room: '201' },
  { id: 'u4', name_jp: 'æ å°æ¢…', name_en: 'Li Xiaomei', room: '202' },
];

const T = {
  ja: {
    title: 'ãƒ‡ã‚¤ã‚±ã‚¢è¨˜éŒ²',
    subtitle: 'ã‚¿ãƒƒãƒ—ã§ç°¡å˜è¨˜éŒ²',
    listLabel: 'åˆ©ç”¨è€…ã‚’é¸æŠ',
    meal: 'é£Ÿäº‹',
    med: 'æœè–¬',
    toilet: 'æ’æ³„',
    status: 'ä½“èª¿',
    note: 'ãƒ¡ãƒ¢ (ä»»æ„)',
    save: 'è¨˜éŒ²ã‚’ä¿å­˜',
    saved: 'ä¿å­˜ã—ã¾ã—ãŸï¼',
    newRecord: 'åˆ¥ã®è¨˜éŒ²ã‚’ä½œæˆ',
    toList: 'åˆ©ç”¨è€…ã¸æˆ»ã‚‹',
    back: 'æˆ»ã‚‹'
  },
  en: {
    title: 'Care Log',
    subtitle: 'Quick tap entries',
    listLabel: 'Select person',
    meal: 'Meal',
    med: 'Medication',
    toilet: 'Toilet',
    status: 'Condition',
    note: 'Note (optional)',
    save: 'Save record',
    saved: 'Saved!',
    newRecord: 'Create another',
    toList: 'Back to list',
    back: 'Back'
  }
};

let lang = 'ja'; // åˆæœŸè¨€èª
let currentUser = null;
let currentRecord = {};

/* ==============
   è¦ç´ ã‚­ãƒ£ãƒƒã‚·ãƒ¥
   ============== */
const userGrid = document.getElementById('userGrid');
const screenList = document.getElementById('screen-list');
const screenRecord = document.getElementById('screen-record');
const screenConfirm = document.getElementById('screen-confirm');

const titleEl = document.getElementById('title');
const subtitleEl = document.getElementById('subtitle');
const listLabel = document.getElementById('listLabel');
const mealLabel = document.getElementById('mealLabel');
const medLabel = document.getElementById('medLabel');
const toiletLabel = document.getElementById('toiletLabel');
const statusLabel = document.getElementById('statusLabel');
const noteLabel = document.getElementById('noteLabel');
const saveBtn = document.getElementById('saveBtn');

const recordName = document.getElementById('recordName');
const recordRoom = document.getElementById('recordRoom');
const backBtn = document.getElementById('backBtn');

const langToggle = document.getElementById('langToggle');

const pvName = document.getElementById('previewName');
const pvTime = document.getElementById('previewTime');
const pvMeal = document.getElementById('pvMeal');
const pvMed = document.getElementById('pvMed');
const pvToilet = document.getElementById('pvToilet');
const pvMood = document.getElementById('pvMood');
const pvNote = document.getElementById('pvNote');

const newRecordBtn = document.getElementById('newRecord');
const toListBtn = document.getElementById('toList');

const noteInput = document.getElementById('note');

/* ============
   åˆæœŸãƒ¬ãƒ³ãƒ€ãƒ¼
   ============ */
function renderUsers(){
  userGrid.innerHTML = '';
  for(const u of USERS){
    const div = document.createElement('div');
    div.className = 'user';
    div.tabIndex = 0;
    div.setAttribute('role','button');
    div.innerHTML = `
      <div class="avatar">${u.name_jp.charAt(0)}</div>
      <div class="uinfo">
        <div class="name">${lang === 'ja' ? u.name_jp : u.name_en}</div>
        <div class="sub">Room ${u.room}</div>
      </div>
    `;
    div.addEventListener('click', ()=> openRecord(u));
    div.addEventListener('keydown', (e)=>{ if(e.key==='Enter') openRecord(u) });
    userGrid.appendChild(div);
  }
}

function applyTranslations(){
  const t = T[lang];
  titleEl.textContent = t.title;
  subtitleEl.textContent = t.subtitle;
  listLabel.textContent = t.listLabel;
  mealLabel.textContent = t.meal;
  medLabel.textContent = t.med;
  toiletLabel.textContent = t.toilet;
  statusLabel.textContent = t.status;
  noteLabel.textContent = t.note;
  saveBtn.textContent = t.save;
  document.getElementById('confirmMsg').textContent = t.saved;
  newRecordBtn.textContent = t.newRecord;
  toListBtn.textContent = t.toList;
  backBtn.textContent = t.back;
  langToggle.textContent = (lang==='ja' ? 'æ—¥æœ¬èª' : 'English');

  // update user names
  renderUsers();
}

/* ============
   ç”»é¢é·ç§»
   ============ */
function showScreen(screen){
  screenList.classList.remove('active');
  screenRecord.classList.remove('active');
  screenConfirm.classList.remove('active');
  screen.classList.add('active');
}

function openRecord(user){
  currentUser = user;
  currentRecord = {
    userId: user.id,
    ts: new Date().toISOString(),
    meal: null,
    med: null,
    toilet: null,
    mood: null,
    note: ''
  };
  recordName.textContent = (lang==='ja' ? user.name_jp : user.name_en);
  recordRoom.textContent = 'éƒ¨å±‹: ' + user.room;
  noteInput.value = '';
  clearToggles();
  showScreen(screenRecord);
}

/* ============
   ãƒˆã‚°ãƒ«å‡¦ç†
   ============ */
function clearToggles(){
  document.querySelectorAll('.opt').forEach(el=>el.classList.remove('toggled'));
  document.querySelectorAll('.pill').forEach(el=>el.classList.remove('toggled'));
}

function setToggle(el){
  const key = el.getAttribute('data-key');
  const value = el.getAttribute('data-value');
  // åŒã˜ã‚°ãƒ«ãƒ¼ãƒ—ã®è¦ç´ ã‚’offã«ã™ã‚‹
  document.querySelectorAll(`[data-key="${key}"]`).forEach(x=>x.classList.remove('toggled'));
  el.classList.add('toggled');
  currentRecord[key] = value;
}

/* attach listeners for all toggleable items */
document.addEventListener('click', (e)=>{
  const opt = e.target.closest('.opt');
  if(opt && opt.hasAttribute('data-key')){
    setToggle(opt);
  }
  const pill = e.target.closest('.pill');
  if(pill && pill.hasAttribute('data-key')){
    setToggle(pill);
  }
});

/* ============
   ä¿å­˜ï¼ˆç°¡æ˜“ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ï¼‰
   ============ */
function saveRecord(){
  currentRecord.note = noteInput.value.trim();
  currentRecord.ts = new Date().toISOString();
  // load existing demo storage
  let arr = JSON.parse(localStorage.getItem('care_demo_records') || '[]');
  arr.push(currentRecord);
  localStorage.setItem('care_demo_records', JSON.stringify(arr));
  showPreview();
}

function showPreview(){
  if(!currentUser) return;
  pvName.textContent = (lang==='ja' ? currentUser.name_jp : currentUser.name_en);
  pvTime.textContent = new Date(currentRecord.ts).toLocaleString();
  pvMeal.textContent = mapValue('meal', currentRecord.meal);
  pvMed.textContent = mapValue('med', currentRecord.med);
  pvToilet.textContent = mapValue('toilet', currentRecord.toilet);
  pvMood.textContent = mapValue('mood', currentRecord.mood);
  pvNote.textContent = currentRecord.note || (lang==='ja' ? 'ãªã—' : 'â€”');
  showScreen(screenConfirm);
}

/* map value keys to readable text */
function mapValue(key, val){
  const map = {
    meal: {
      full: lang==='ja' ? 'å®Œé£Ÿ' : 'Full',
      half: lang==='ja' ? 'åŠåˆ†' : 'Half',
      little: lang==='ja' ? 'å°‘ã—' : 'Little',
      refuse: lang==='ja' ? 'æ‹’å¦' : 'Refused',
      null: lang==='ja' ? 'æœªè¨­å®š' : 'â€”'
    },
    med: {
      ok: lang==='ja' ? 'é£²ã‚“ã ' : 'Taken',
      refuse: lang==='ja' ? 'æ‹’å¦' : 'Refused',
      miss: lang==='ja' ? 'å¿˜ã‚Œ' : 'Missed',
      'n/a': lang==='ja' ? 'ä¸è¦' : 'N/A',
      null: lang==='ja' ? 'æœªè¨­å®š' : 'â€”'
    },
    toilet: {
      urine: lang==='ja' ? 'å°¿' : 'Urine',
      stool: lang==='ja' ? 'ä¾¿' : 'Stool',
      both: lang==='ja' ? 'ä¸¡æ–¹' : 'Both',
      none: lang==='ja' ? 'ãªã—' : 'None',
      null: lang==='ja' ? 'æœªè¨­å®š' : 'â€”'
    },
    mood: {
      good: lang==='ja' ? 'è‰¯ã„' : 'Good',
      ok: lang==='ja' ? 'æ™®é€š' : 'OK',
      bad: lang==='ja' ? 'æ‚ªã„' : 'Bad',
      null: lang==='ja' ? 'æœªè¨­å®š' : 'â€”'
    }
  };
  if(!val) return map[key].null || 'â€”';
  return map[key][val] || 'â€”';
}

/* ============
   UI ã‚¤ãƒ™ãƒ³ãƒˆ
   ============ */
saveBtn.addEventListener('click', ()=> {
  saveRecord();
});

backBtn.addEventListener('click', ()=> {
  showScreen(screenList);
});

newRecordBtn.addEventListener('click', ()=> {
  // same user, clear form to make a new record
  openRecord(currentUser);
});

toListBtn.addEventListener('click', ()=> {
  currentUser = null;
  showScreen(screenList);
});

langToggle.addEventListener('click', ()=> {
  lang = (lang === 'ja' ? 'en' : 'ja');
  applyTranslations();
});

/* åˆæœŸå‡¦ç† */
applyTranslations();
renderUsers();

/* ============================
   é–‹ç™ºãƒ¡ãƒ¢ï¼ˆãƒ‡ãƒ¢ç”¨ã®å·¥å¤«ï¼æ‹¡å¼µæ¡ˆï¼‰
   - localStorage ã¸ã®ä¿å­˜ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹ãŸã‚ã€å®Ÿæ©Ÿã§é€£ç¶šæ“ä½œã®ç¢ºèªãŒã§ãã¾ã™ã€‚
   - æœ¬ç•ªã§ã¯ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä¿å­˜ï¼ˆIndexedDBï¼‰ + åŒæœŸãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã¨è‰¯ã„ã§ã™ã€‚
   - å¤šè¨€èªã¯ç¾çŠ¶ãƒ©ãƒ™ãƒ«ã®ã¿ã€‚å°†æ¥çš„ã«ç¿»è¨³è¾æ›¸ï¼ˆåŒ»ç™‚ç”¨èªè¾æ›¸ï¼‰ã§æ„å‘³ã®æºã‚Œã‚’é˜²ãã¾ã™ã€‚
   - éŸ³å£°å…¥åŠ›ã‚„ã‚¢ã‚¤ã‚³ãƒ³å·®ã—æ›¿ãˆã€ã‚¿ãƒƒãƒ—é•·æŠ¼ã—ã§ã®è©³ç´°å…¥åŠ›ãªã©ã‚‚æ¤œè¨ã§ãã¾ã™ã€‚
   ============================ */
</script>
</body>
</html>
