{% extends "base.html" %}
{% block content %}
<style>
  .family-wrap {
    max-width: 900px;
    margin: 0 auto;
  }
  .card {
    background: #fff;
    border: none;
    border-radius: 18px;
    box-shadow: 0 12px 32px rgba(0,0,0,.08);
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 40px rgba(0,0,0,.1);
  }
  h2.title {
    font-weight: 800;
    letter-spacing: .08em;
    color: #173d2a;
    text-align: center;
    margin-bottom: 1.5rem;
  }
  .btn-main {
    background: #256b3f;
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 6px 16px;
    transition: background .2s;
  }
  .btn-main:hover {
    background: #1e5833;
  }
</style>

<div class="family-wrap mt-4">
  <div class="text-center mb-3">
    <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-sm">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
  </div>

  <h2 class="title">å®¶æ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†</h2>

  <!-- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ -->
  <div class="card p-4 mb-4">
    <h4 class="mb-3">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶æ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</h4>
    <form method="post" action="{{ url_for('admin_family_add') }}" class="row g-3 align-items-center">
      <div class="col-md-5">
        <input name="name" class="form-control" placeholder="å®¶æ—å" required>
      </div>
      <div class="col-md-5">
        <input name="password" class="form-control" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required type="password">
      </div>
      <div class="col-md-2 text-end">
        <button class="btn-main w-100">ä½œæˆ</button>
      </div>
    </form>
  </div>

  <!-- åˆ©ç”¨è€…ã¨ã®ç´ã¥ã‘ -->
  <div class="card p-4 mb-4">
    <h4 class="mb-3">ğŸ”— åˆ©ç”¨è€…ã¨ã®ç´ã¥ã‘</h4>
    <form method="post" action="{{ url_for('admin_family_map') }}" class="row g-3 align-items-center">
      <div class="col-md-5">
        <select name="family_name" class="form-select" required>
          {% for f in families %}
            <option value="{{ f.name }}">{{ f.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-5">
        <select name="user_id" class="form-select" required>
          {% for u in users %}
            <option value="{{ u.id }}">{{ u.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 text-end">
        <button class="btn-main w-100">ç´ã¥ã‘</button>
      </div>
    </form>
  </div>

  <!-- ç´ã¥ã‘ä¸€è¦§ -->
  <div class="card p-4 mb-4">
    <h4 class="mb-3">ğŸ“‹ ç¾åœ¨ã®ç´ã¥ã‘ä¸€è¦§</h4>
    {% if maps %}
      <table class="table table-striped align-middle">
        <thead>
          <tr><th>å®¶æ—å</th><th>åˆ©ç”¨è€…ID</th><th>è§£é™¤</th></tr>
        </thead>
        <tbody>
        {% for m in maps %}
          <tr>
            <td>{{ m.family_name }}</td>
            <td>{{ m.user_id }}</td>
            <td>
              <form method="post" action="{{ url_for('admin_family_unmap') }}">
                <input type="hidden" name="family_name" value="{{ m.family_name }}">
                <input type="hidden" name="user_id" value="{{ m.user_id }}">
                <button class="btn btn-sm btn-outline-danger">è§£é™¤</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">ã¾ã ç´ã¥ã‘ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}
  </div>

  <!-- å®¶æ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§ -->
  <div class="card p-4 mb-5">
    <h4 class="mb-3">ğŸ‘ª å®¶æ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¸€è¦§</h4>
    {% if families %}
      <table class="table align-middle">
        <thead><tr><th>ID</th><th>åå‰</th><th>å‰Šé™¤</th></tr></thead>
        <tbody>
          {% for f in families %}
            <tr>
              <td>{{ f.id }}</td>
              <td>{{ f.name }}</td>
              <td>
                <form method="post" action="{{ url_for('admin_family_delete', fid=f.id) }}" onsubmit="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                  <button class="btn btn-sm btn-outline-danger">å‰Šé™¤</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">ã¾ã å®¶æ—ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endif %}
  </div>

  <div class="text-center mb-4">
    <a href="{{ url_for('home') }}" class="btn btn-outline-secondary">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
  </div>
</div>
{% endblock %}
