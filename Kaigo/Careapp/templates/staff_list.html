{% extends "base.html" %}
{% block body %}
<div class="card p-3">
  <h5 class="mb-3">{{ _('スタッフ一覧') }}</h5>

  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>{{ _('スタッフ') }}</th>
        <th>{{ _('役割') }}</th>
        <th>QR</th>
        <th>{{ _('操作') }}</th>
      </tr>
    </thead>
    <tbody>
      {% for s in staff_list %}
      <tr>
        <td>{{ s[0] }}</td>
        <td>{{ s[1] }}</td>
        <td>{{ s[3] or '-' }}</td>
        <td>
          {% if s[4] %}
            <img src="{{ url_for('qr_png', token=s[4]) }}" alt="QR" height="64">
          {% else %}
            <span class="text-muted">-</span>
          {% endif %}
        </td>
        <td>
          <!-- 削除ボタン：data-msg属性を使用 -->
          <a class="btn btn-sm btn-danger"
             href="{{ url_for('delete_staff', sid=s[0]) }}"
             data-msg="{{ _('本当に削除しますか？') }}">
            {{ _('削除') }}
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="d-flex gap-2">
    <a class="btn btn-outline-success" href="{{ url_for('generate_qr') }}">{{ _('QR発行') }}</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin_page') }}">{{ _('戻る') }}</a>
  </div>
</div>

<!-- JSで削除確認ダイアログを一括処理（赤線出ない） -->
<script>
  document.addEventListener('click', function (ev) {
    const a = ev.target.closest('a[data-msg]');
    if (!a) return;
    const msg = a.dataset.msg;
    if (!confirm(msg)) {
      ev.preventDefault();
      ev.stopPropagation();
    }
  });
</script>
{% endblock %}
