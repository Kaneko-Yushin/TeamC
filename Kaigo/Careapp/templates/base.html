<!doctype html>
<html lang="{{ get_locale() }}">
  <head>
    <meta charset="utf-8">
    <title>{{ _("デジタル介護日誌") }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
      body.main-wrap { background:#f5faf7; min-height:100vh; font-family:"Segoe UI", system-ui, sans-serif; }
      .app-bar { background:#256b3f; color:#fff; padding:.75rem 1.25rem; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; }
      .app-bar a { color:#fff; text-decoration:none; }
      .app-title { font-weight:700; font-size:1.2rem; }
      footer { text-align:center; color:#6c757d; font-size:.9rem; padding:2rem 0; }

      /* 翻訳ウィジェット */
      #google_translate_element .goog-te-gadget-simple {
        background:#ffffff;
        border-radius:10px;
        padding:2px 6px;
        border:none;
      }
      #google_translate_element img.goog-te-gadget-icon { display:none; }
      #google_translate_element .goog-te-menu-value { color:#1f2937; }
      .gt-wrap { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    </style>
  </head>

  <body class="main-wrap">
    <!-- ヘッダー -->
    <header class="app-bar">
      <a href="{{ url_for('home') }}" class="app-title">{{ _("デジタル介護日誌") }}</a>

      <div class="gt-wrap">
        <!-- ★ Google翻訳ウィジェット -->
        <div id="google_translate_element"></div>
        <!-- ★ 日本語に戻すボタン -->
        <button class="btn btn-sm btn-light" onclick="restoreJapanese()">日本語に戻す</button>

        {% if session.get('staff_name') %}
          <span class="ms-2">{{ session['staff_name'] }}{% if session.get('staff_role') %} ({{ session['staff_role'] }}){% endif %}</span>
          <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-light ms-2">{{ _("ログアウト") }}</a>
        {% else %}
          <a href="{{ url_for('staff_login') }}" class="btn btn-sm btn-outline-light">{{ _("ログイン") }}</a>
        {% endif %}
      </div>
    </header>

    <!-- メイン -->
    <main class="container py-4">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="mb-3">
            {% for msg in messages %}
              <div class="alert alert-info">{{ msg }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}
      {% block content %}{% endblock %}
    </main>

    <!-- フッター -->
    <footer>© 2025 Digital Care Notes</footer>

    <!-- Google翻訳（多言語フル対応） -->
    <script>
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({
          pageLanguage: 'ja',
          includedLanguages: 'en,vi,zh-CN,id,ne,tl,es,ko',
          layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'google_translate_element');
      }

      // 日本語に戻す関数
      function restoreJapanese() {
        const iframe = document.querySelector('iframe.goog-te-menu-frame');
        if (iframe) {
          const innerDoc = iframe.contentDocument || iframe.contentWindow.document;
          const jaOption = innerDoc.querySelector('.goog-te-menu2-item span.text:contains("Japanese")');
          if (jaOption) jaOption.click();
        }
        // URLのパラメータ削除（翻訳クエリをリセット）
        const url = new URL(window.location.href);
        url.searchParams.delete('hl');
        url.searchParams.delete('sl');
        url.searchParams.delete('tl');
        window.location.href = url.toString();
      }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
