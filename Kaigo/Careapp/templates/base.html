<!doctype html>
<html lang="{{ get_locale() }}">
  <head>
    <meta charset="utf-8">
    <title>{{ _("ãƒ‡ã‚¸ã‚¿ãƒ«ä»‹è­·æ—¥èªŒ") }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <!-- PWA -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#256b3f">

    <style>
      :root { --app-green:#256b3f; }
      body.main-wrap { background:#f5faf7; min-height:100vh; font-family:"Segoe UI", system-ui, -apple-system, sans-serif; }
      .app-bar { background:var(--app-green); }
      .navbar-brand { font-weight:700; letter-spacing:.02em; }
      .nav-link, .navbar-brand { color:#fff !important; }
      .navbar .dropdown-menu { min-width:14rem; }
      .badge-role { background:#ffffff1a; color:#fff; border:1px solid #ffffff33; }
      footer { text-align:center; color:#6c757d; font-size:.9rem; padding:2rem 0; }

      /* ç¿»è¨³ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®è¦‹ãŸç›® */
      #google_translate_element .goog-te-gadget-simple {
        background:#ffffff; border-radius:10px; padding:2px 6px; border:none;
      }
      #google_translate_element img.goog-te-gadget-icon { display:none; }
      #google_translate_element .goog-te-menu-value { color:#1f2937; }

      /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼ä½™ç™½èª¿æ•´ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰ */
      .gt-wrap { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    </style>
  </head>

  <body class="main-wrap">
    <!-- ===== ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ ===== -->
    <nav class="navbar navbar-expand-lg app-bar">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('home') }}">{{ _("ãƒ‡ã‚¸ã‚¿ãƒ«ä»‹è­·æ—¥èªŒ") }}</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav" aria-controls="topNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon" style="filter:invert(1);"></span>
        </button>

        <div class="collapse navbar-collapse" id="topNav">
          <!-- å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            {% if session.get('staff_name') %}
              <!-- è·å“¡ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
              <li class="nav-item"><a class="nav-link" href="{{ url_for('add_record') }}">ğŸ“ {{ _("è¨˜éŒ²å…¥åŠ›") }}</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('records') }}">ğŸ“– {{ _("è¨˜éŒ²ä¸€è¦§") }}</a></li>
              <li class="nav-item"><a class="nav-link" href="{{ url_for('handover') }}">ğŸ—‚ï¸ {{ _("å¼•ç¶™ã") }}</a></li>

              {% if session.get('staff_role') == 'admin' %}
                <!-- ç®¡ç†è€…ã ã‘ -->
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">âš™ï¸ {{ _("ç®¡ç†") }}</a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{{ url_for('admin_page') }}">è¨­å®šï¼ˆç®¡ç†ç”»é¢ï¼‰</a></li>
                    <li><a class="dropdown-item" href="{{ url_for('users_page') }}">åˆ©ç”¨è€…ä¸€è¦§</a></li>
                    <li><a class="dropdown-item" href="{{ url_for('add_user') }}">åˆ©ç”¨è€…ç™»éŒ²</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{{ url_for('staff_list') }}">ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§</a></li>
                    <li><a class="dropdown-item" href="{{ url_for('generate_qr') }}">QRã‚³ãƒ¼ãƒ‰ç™ºè¡Œ</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{{ url_for('camera_page') }}">è¦‹å®ˆã‚Šã‚«ãƒ¡ãƒ©</a></li>
                  </ul>
                </li>
              {% endif %}
            {% endif %}

            {% if session.get('family_name') %}
              <!-- å®¶æ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
              <li class="nav-item"><a class="nav-link" href="{{ url_for('family_home') }}">ğŸ  å®¶æ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼</a></li>
            {% endif %}
          </ul>

          <!-- å³å´ï¼šç¿»è¨³ãƒ»ãƒ­ã‚°ã‚¤ãƒ³é–¢é€£ -->
          <div class="d-flex align-items-center gap-2 flex-wrap">
            <div class="gt-wrap">
              <div id="google_translate_element"></div>
              <button class="btn btn-sm btn-light" onclick="restoreJapanese()">æ—¥æœ¬èªã«æˆ»ã™</button>
            </div>

            {% if session.get('staff_name') %}
              <span class="badge rounded-pill badge-role ms-1">
                {{ session['staff_name'] }}{% if session.get('staff_role') %} ({{ session['staff_role'] }}){% endif %}
              </span>
              <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-light ms-1">{{ _("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ") }}</a>
            {% elif session.get('family_name') %}
              <span class="badge rounded-pill badge-role ms-1">{{ session['family_name'] }} (family)</span>
              <a href="{{ url_for('family_logout') }}" class="btn btn-sm btn-outline-light ms-1">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            {% else %}
              <div class="dropdown">
                <a class="btn btn-sm btn-outline-light dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  ãƒ­ã‚°ã‚¤ãƒ³
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="{{ url_for('staff_login') }}">è·å“¡ãƒ­ã‚°ã‚¤ãƒ³</a></li>
                  <li><a class="dropdown-item" href="{{ url_for('family_login') }}">å®¶æ—ãƒ­ã‚°ã‚¤ãƒ³</a></li>
                </ul>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>

    <!-- ===== ãƒ¡ã‚¤ãƒ³ ===== -->
    <main class="container py-4">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="mb-3">
            {% for msg in messages %}
              <div class="alert alert-info">{{ msg }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

    <!-- ===== ãƒ•ãƒƒã‚¿ãƒ¼ ===== -->
    <footer>Â© 2025 Digital Care Notes</footer>

    <!-- ===== Googleç¿»è¨³ï¼š8è¨€èªå¯¾å¿œ + æ—¥æœ¬èªå¾©å¸°ï¼ˆç¢ºå®Ÿç‰ˆï¼‰ ===== -->
    <script>
      function googleTranslateElementInit() {
        new google.translate.TranslateElement({
          pageLanguage: 'ja',
          includedLanguages: 'en,vi,zh-CN,id,ne,tl,es,ko',
          layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'google_translate_element');
      }

      // æ—¥æœ¬èªã«æˆ»ã™ï¼šgoogtrans ã‚’å…¨éšå±¤ã§ãƒªã‚»ãƒƒãƒˆã— /auto/ja ã‚’è¨­å®šã—ã¦ãƒªãƒ­ãƒ¼ãƒ‰
      function restoreJapanese() {
        try {
          var host = location.hostname;
          var parts = host.split('.');
          function clearSet(domain) {
            document.cookie = 'googtrans=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=' + domain;
            document.cookie = 'googtrans=/auto/ja; path=/; domain=' + domain;
          }
          for (var i=0; i<parts.length-1; i++) {
            clearSet('.' + parts.slice(i).join('.'));
          }
          // ãƒ‰ãƒ¡ã‚¤ãƒ³æŒ‡å®šãªã—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚åŠ¹ãï¼‰
          document.cookie = 'googtrans=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';
          document.cookie = 'googtrans=/auto/ja; path=/';

          // URLã®ç¿»è¨³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤
          var url = new URL(location.href);
          url.searchParams.delete('hl'); url.searchParams.delete('sl'); url.searchParams.delete('tl');
          if (url.hash) url.hash = '';

          location.replace(url.toString());
        } catch(e) { location.reload(true); }
      }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <!-- PWA: Service Worker ç™»éŒ² -->
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/static/sw.js').catch(console.error);
      }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
